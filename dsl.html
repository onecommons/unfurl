<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A TOSCA Python-based DSL &mdash; Unfurl Documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon32.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TOSCA Language Reference" href="toscaref.html" />
    <link rel="prev" title="TOSCA" href="tosca.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/unfurl_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="solution-overview.html">Solution Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Unfurl Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembles.html">Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobs.html">Jobs and Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="tosca.html">TOSCA</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">TOSCA as Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-a-dsl-domain-specic-language">Why a DSL (Domain Specic Language)?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-python">Why Python?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scalars">Scalars</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interfaces-and-operations">Interfaces and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orchestrator-integration">Orchestrator Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#node-filters">Node Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#names-and-identifiers">Names and Identifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imports-and-repositories">Imports and Repositories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#yaml-to-python">YAML to Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-to-yaml">Python to YAML</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#safe-mode">Safe Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="toscaref.html">TOSCA Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Repositories and Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="secrets.html">Managing Secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html">Configurators</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#installers">Installers</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#id38">Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing.html">Template Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="expressions.html">Expression Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloudmap.html">Cloud Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog for Unfurl</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Unfurl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">A TOSCA Python-based DSL</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dsl.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-tosca-python-based-dsl">
<h1>A TOSCA Python-based DSL<a class="headerlink" href="#a-tosca-python-based-dsl" title="Permalink to this headline"></a></h1>
<p>This package implements a Python representation of <a class="reference external" href="https://docs.oasis-open.org/tosca/TOSCA-Simple-Profile-YAML/v1.3/os/TOSCA-Simple-Profile-YAML-v1.3-os.html">TOSCA 1.3</a>. It converts TOSCA YAML to Python and vice versa. It can be used as a library by a TOSCA processor or as a stand-alone conversion tool.</p>
<p>TOSCA (Topology and Orchestration Specification for Cloud Applications) is an <a class="reference external" href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=tosca">OASIS open standard</a> that provides language to describe a topology of cloud based web services, their components, relationships, and the processes that manage them. TOSCA provides mechanisms for abstraction and composition, thereby enabling portability and automated management across cloud providers regardless of underlying platform or infrastructure.</p>
<section id="why-a-dsl-domain-specic-language">
<h2>Why a DSL (Domain Specic Language)?<a class="headerlink" href="#why-a-dsl-domain-specic-language" title="Permalink to this headline"></a></h2>
<p>Why build a DSL for TOSCA? Or more precisely, why build an <a class="reference external" href="https://en.wikipedia.org/wiki/Domain-specific_language#External_and_Embedded_Domain_Specific_Languages">embedded (or internal) DSL</a> – a DSL that is a subset of an existing programming language?</p>
<ul class="simple">
<li><p>Avoid what is affectionately known as “YAML hell”. YAML’s syntax is limited to expressing basic data types and has <a class="reference external" href="https://noyaml.com">various quirks</a> that makes it hard to manage at scale. But TOSCA is a fairly strongly typed language, so expressing it in a syntax that can reflect that makes for a much more powerful solution with regard to developer usability and tooling.</p></li>
<li><p>Expressiveness. With a full-fledged programming language as the host language (ie. Python), you have all its facilities for writing good code.</p></li>
<li><p>Reduced learning curve. By mapping to TOSCA syntax to existing language constructs like classes and methods and by rely on type inference we can present a simpler and more intuitive mental model to developers. For example, TOSCA’s notions of requirements, capabilities, properties, and artifacts are all represented the same way as regular Python attributes assigned to a Python class.</p></li>
<li><p>IDE and tooling integration. You can take advantage of all of the existing IDE and tooling integrations for the host language (ie. Python).</p></li>
</ul>
<p><img alt="VS Code displaying tooltip" src="https://raw.githubusercontent.com/onecommons/unfurl/main/tosca-package/vs-tosca-python-error-tooltip.png" /></p>
<p>Using our TOSCA DSL, VS-Code will detect missing or invalid node template properties and requirements out of the box.</p>
<section id="why-python">
<h3>Why Python?<a class="headerlink" href="#why-python" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Accessability. Python is an easy-to-use language usable by all skill levels of developers and the second mostly widely known programming language (after Javascript).</p></li>
<li><p>Ease of integration. There is a huge ecosystem of Python tools and library in the cloud computing and DevOps space and using a Python DSL makes it easy to integrate them. For example, we plan to integrate <a class="reference external" href="https://pydantic.dev/">Pydantic</a> for data validation of properties and attributes.</p></li>
<li><p>Gradual typing. Type annotations are optional in Python allowing for rapid prototyping and making it easy to apply TOSCA to wide range of use cases. You can quickly build loosely defined models for on-off sys admin tasks or complex models with statically enforced constraints using Python’s meta-programming facilities.</p></li>
</ul>
</section>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h2>
<p>If you want to use this as a Python library, <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">tosca</span></code>. For a command line tool that converts between YAML and Python, or for a TOSCA orchestrator with native support, install <a class="reference external" href="https://github.com/onecommons/unfurl">unfurl</a>, which integrates this library.</p>
<p>Requirements: Python versions 3.8 or later.</p>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline"></a></h2>
<p>Experimental, syntax subject to change based on feedback. Currently converts a significant subset of TOSCA 1.3, to and from Python and YAML but there are still significant gaps. 100% coverage is not a goal since YAML can be used as a fallback for the less common elements. Also, YAML-to-Python completeness is less of a priority than Python-to-YAML since the former is a just a convenience, while the latter is required for the DSL to be useable.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline"></a></h2>
<p>Let’s start with the “hello world” template in the TOSCA 1.3 Specification (Section 2.1, Example 1):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Template for deploying a single server with predefined properties.</span>
<span class="nt">topology_template</span><span class="p">:</span>
<span class="w">  </span><span class="nt">node_templates</span><span class="p">:</span>
<span class="w">    </span><span class="nt">db_server</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">      </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Host container properties</span>
<span class="w">        </span><span class="nt">host</span><span class="p">:</span>
<span class="w">         </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">           </span><span class="nt">num_cpus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">           </span><span class="nt">disk_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10 GB</span>
<span class="w">           </span><span class="nt">mem_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096 MB</span>
<span class="w">        </span><span class="c1"># Guest Operating System properties</span>
<span class="w">        </span><span class="nt">os</span><span class="p">:</span>
<span class="w">          </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># host Operating System image properties</span>
<span class="w">            </span><span class="nt">architecture</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x86_64</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
<span class="w">            </span><span class="nt">distribution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhel</span>
<span class="w">            </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;6.5&quot;</span>
</pre></div>
</div>
<p>Here’s the same template translated to Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Template for deploying a single server with predefined properties.&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tosca</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tosca</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>  <span class="c1"># imports GB and MB scalars</span>
<span class="n">db_server</span> <span class="o">=</span> <span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Compute</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">Compute</span><span class="p">(</span>
        <span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">disk_size</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">GB</span><span class="p">,</span>
        <span class="n">mem_size</span><span class="o">=</span><span class="mi">4096</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">os</span><span class="o">=</span><span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">OperatingSystem</span><span class="p">(</span>
        <span class="n">architecture</span><span class="o">=</span><span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linux&quot;</span><span class="p">,</span>
        <span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;rhel&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s2">&quot;6.5&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It looks very similar, except explicit types are required when assigning the <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">os</span></code> capabilities and properties that have unit values (<code class="docutils literal notranslate"><span class="pre">disk_size</span></code> and <code class="docutils literal notranslate"><span class="pre">mem_size</span></code>).</p>
<p>Things are a little more interesting when defining a TOSCA node type in Python.
Consider this example from the TOSCA 1.3 Specification (in section 9.3.4.2):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">node_types</span><span class="p">:</span>
<span class="w">  </span><span class="nt">WordPress</span><span class="p">:</span>
<span class="w">    </span><span class="nt">derived_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.WebApplication</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">        </span><span class="nt">admin_user</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">admin_password</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">db_host</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">database_endpoint</span><span class="p">:</span>
<span class="w">          </span><span class="nt">capability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.capabilities.Endpoint.Database</span>
<span class="w">          </span><span class="nt">node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Database</span>
<span class="w">          </span><span class="nt">relationship</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.relationships.ConnectsTo</span>
</pre></div>
</div>
<p>Its Python representation looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tosca</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WordPress</span><span class="p">(</span><span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">WebApplication</span><span class="p">):</span>
    <span class="n">admin_user</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">admin_password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">db_host</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">database_endpoint</span><span class="p">:</span> <span class="n">tosca</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">ConnectsTo</span> <span class="o">|</span> <span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Database</span> <span class="o">|</span> <span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">EndpointDatabase</span>
</pre></div>
</div>
<p>Here we see how our DSL can infer whether a field is a TOSCA property or TOSCA requirement based on the field’s type – for example, only requirements can be assigned a relationship, so <code class="docutils literal notranslate"><span class="pre">database_endpoint</span></code> must be a TOSCA requirement, and data types like strings default to TOSCA properties.</p>
<p>If you need to specify TOSCA specific information about the field or need to resolve ambiguity about the fields type, you use can field specifiers. For example, consider this Python representation of the <code class="docutils literal notranslate"><span class="pre">tosca.nodes.Compute</span></code> node type defined in the TOSCA 1.3 spec:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Compute</span><span class="p">(</span><span class="n">AbstractCompute</span><span class="p">):</span>
    <span class="n">_type_name</span> <span class="o">=</span> <span class="s2">&quot;tosca.nodes.Compute&quot;</span>
    <span class="n">private_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">()</span>
    <span class="n">public_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">()</span>
    <span class="n">networks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;datatypes.NetworkNetworkInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">()</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;datatypes.NetworkPortInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">()</span>

    <span class="n">host</span><span class="p">:</span> <span class="s2">&quot;capabilities.Compute&quot;</span> <span class="o">=</span> <span class="n">Capability</span><span class="p">(</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">capabilities</span><span class="o">.</span><span class="n">Compute</span><span class="p">,</span>
        <span class="n">valid_source_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tosca.nodes.SoftwareComponent&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">binding</span><span class="p">:</span> <span class="s2">&quot;capabilities.NetworkBindable&quot;</span> <span class="o">=</span> <span class="n">Capability</span><span class="p">(</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">capabilities</span><span class="o">.</span><span class="n">NetworkBindable</span>
    <span class="p">)</span>

    <span class="n">os</span><span class="p">:</span> <span class="s2">&quot;capabilities.OperatingSystem&quot;</span> <span class="o">=</span> <span class="n">Capability</span><span class="p">(</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">capabilities</span><span class="o">.</span><span class="n">OperatingSystem</span>
    <span class="p">)</span>

    <span class="n">scalable</span><span class="p">:</span> <span class="s2">&quot;capabilities.Scalable&quot;</span> <span class="o">=</span> <span class="n">Capability</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="n">capabilities</span><span class="o">.</span><span class="n">Scalable</span><span class="p">)</span>

    <span class="n">endpoint</span><span class="p">:</span> <span class="s2">&quot;capabilities.EndpointAdmin&quot;</span> <span class="o">=</span> <span class="n">Capability</span><span class="p">(</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">capabilities</span><span class="o">.</span><span class="n">EndpointAdmin</span>
    <span class="p">)</span>

    <span class="n">local_storage</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span>
        <span class="s2">&quot;relationships.AttachesTo&quot;</span> <span class="o">|</span>
        <span class="s2">&quot;nodes.StorageBlockStorage&quot;</span> <span class="o">|</span>
        <span class="s2">&quot;capabilities.Attachment&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">Requirement</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">())</span>
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">Attribute()</span></code> field specifier is used to indicate a field is an TOSCA attribute, not a property (the default for data types), and <code class="docutils literal notranslate"><span class="pre">Capability()</span></code> and <code class="docutils literal notranslate"><span class="pre">Requirement()</span></code> also used as field specifiers. Note that we can infer that <code class="docutils literal notranslate"><span class="pre">local_storage</span></code> has <code class="docutils literal notranslate"><span class="pre">occurrences:</span> <span class="pre">[0,</span> <span class="pre">UNBOUNDED]</span></code> because the type is a sequence and its default value is an empty sequence. See the <a class="reference external" href="https://docs.unfurl.run/api.html#tosca-field-specifiers">API documentation</a> for the full list of field specifiers.</p>
<p>Also note <code class="docutils literal notranslate"><span class="pre">_type_name</span></code>, which can be used to name the type when the YAML identifier doesn’t conform to Python’s identifier syntax.</p>
<p>You can see all of TOSCA 1.3’s pre-defined types as automatically converted from YAML to Python <a class="reference external" href="https://github.com/onecommons/unfurl/blob/main/tosca-package/tosca/builtin_types.py">here</a>.</p>
<section id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline"></a></h3>
<p>TOSCA’s data types include <a class="reference external" href="https://docs.unfurl.run/_static/TOSCA-Simple-Profile-YAML-v1.3-os-toc.html#_Toc50125205">scalar units</a> for different dimensions: size (e.g. MB, MiB, GiB, GB), time (e.g. d, s, ms), frequency (e.g. kHz, Ghz) and bitrates (e.g. Kbps, GBps).</p>
<p>The DSL provides these scalar units as first-class Python types, so you can avoid mistakes calculating values with mismatched units.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tosca</span><span class="w"> </span><span class="kn">import</span> <span class="n">GB</span><span class="p">,</span> <span class="n">MB</span><span class="p">,</span> <span class="n">GHz</span>
<span class="n">mem_size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">GB</span>
<span class="n">mem_size</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">*</span><span class="n">MB</span> <span class="c1"># 3 GB</span>
<span class="n">mem_size</span> <span class="o">+</span> <span class="mi">50</span><span class="o">*</span><span class="n">GHz</span> <span class="c1"># static type error!</span>
</pre></div>
</div>
<p>When generating configuration, the value can be converted to the unit that the configuration expects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MB</span><span class="o">.</span><span class="n">as_int</span><span class="p">(</span><span class="n">mem_size</span><span class="p">)</span>  <span class="c1"># return an integer with the value in MBs</span>
<span class="n">GHz</span><span class="o">.</span><span class="n">as_int</span><span class="p">(</span><span class="n">mem_size</span><span class="p">)</span> <span class="c1"># static type error!</span>
</pre></div>
</div>
</section>
<section id="interfaces-and-operations">
<h3>Interfaces and Operations<a class="headerlink" href="#interfaces-and-operations" title="Permalink to this headline"></a></h3>
<p>By mapping TOSCA’s interfaces and operations to Python’s classes and methods we can create a TOSCA syntax that is concise, intuitive, and easily statically validated. Consider this definition of a custom interface and its implementation by a node type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="k">class</span><span class="w"> </span><span class="nc">MyCustomInterface</span><span class="p">(</span><span class="n">tosca</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>
      <span class="k">class</span><span class="w"> </span><span class="nc">Inputs</span><span class="p">(</span><span class="n">ToscaInputs</span><span class="p">):</span>
          <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
          <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">def</span><span class="w"> </span><span class="nf">my_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="s2">&quot;description of my_operation&quot;</span>
          <span class="o">...</span>  <span class="c1"># an abstract operation, subclass needs to implement </span>

  <span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="p">(</span><span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Root</span><span class="p">,</span> <span class="n">MyCustomInterface</span><span class="p">):</span>
      <span class="n">shellScript</span> <span class="o">=</span> <span class="n">tosca</span><span class="o">.</span><span class="n">artifacts</span><span class="o">.</span><span class="n">ImplementationBash</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;example.sh&quot;</span><span class="p">)</span>
      <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
      <span class="n">host</span><span class="p">:</span> <span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Compute</span>

      <span class="k">def</span><span class="w"> </span><span class="nf">my_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellScript</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
              <span class="n">MyCustomInterface</span><span class="o">.</span><span class="n">Inputs</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">),</span>
              <span class="n">host_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">public_address</span>
          <span class="p">)</span>
</pre></div>
</div>
<p>This will be translated to YAML as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">interface_types</span><span class="p">:</span>
<span class="w">  </span><span class="nt">MyCustomInterface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">derived_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.interfaces.Root</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">location</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">operations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">my_operation</span><span class="p">:</span>
<span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description of my_operation</span>

<span class="nt">node_types</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Example</span><span class="p">:</span>
<span class="w">        </span><span class="nt">derived_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Root</span>
<span class="w">        </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">          </span><span class="nt">shellScript</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.artifacts.ImplementationBash</span>
<span class="w">            </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.sh</span>
<span class="w">        </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">          </span><span class="nt">location</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span>
<span class="w">            </span><span class="nt">node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">        </span><span class="nt">interfaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">MyCustomInterface</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyCustomInterface</span>
<span class="w">            </span><span class="nt">operations</span><span class="p">:</span>
<span class="w">              </span><span class="nt">my_operation</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">primary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shellScript</span>
<span class="w">                </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">location</span><span class="p">:</span>
<span class="w">                    </span><span class="p p-Indicator">{</span><span class="nt">get_property</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">SELF</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">location</span><span class="p p-Indicator">]}</span>
<span class="w">                  </span><span class="nt">host_address</span><span class="p">:</span>
<span class="w">                    </span><span class="p p-Indicator">{</span><span class="nt">get_property</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">SELF</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">host</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">public_address</span><span class="p p-Indicator">]}</span>
</pre></div>
</div>
<p>It interesting to note that the readability improvements in this example stem not just from concision (18 lines vs. 37 lines) but also because of the syntax highlighting for Python – something most Markdown processors support while none support that for TOSCA – another illustration of the benefits of building a DSL on a widely supported language.</p>
</section>
<section id="orchestrator-integration">
<h3>Orchestrator Integration<a class="headerlink" href="#orchestrator-integration" title="Permalink to this headline"></a></h3>
<p>As the example above shows, operations don’t actually perform the work – instead they return the implementation (e.g. artifacts and inputs) that the orchestrator will execute. That’s about as much as you could expect from a pure Python-to-YAML converter.</p>
<p>But if the DSL is integrated into the orchestrator’s runtime, the operation’s implementation can be defined in the class definition too. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tosca</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Integrated</span><span class="p">(</span><span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>
    <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="si">}</span><span class="s2">/&quot;</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">tosca</span><span class="o">.</span><span class="n">Computed</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="n">_url</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="c1"># invoked by the orchestrator when the operation is executed</span>
        <span class="n">do_stuff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span>
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">create()</span></code> operation returns the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method, which will be invoked by the orchestrator. This example also illustrates another mechanism for integrating with the orchestrator by using the <code class="docutils literal notranslate"><span class="pre">Computed()</span></code> field specifier to declare a TOSCA property whose value is computed by the decorated method at runtime.</p>
<p>Unfurl provides this integration and other orchestrators can implement a callback interface to provide similar integration.  In addition, Unfurl will automatically run operation methods during the Unfurl’s planning and render phase if the method executes runtime-only functionality that isn’t available when generating YAML.</p>
</section>
<section id="node-filters">
<h3>Node Filters<a class="headerlink" href="#node-filters" title="Permalink to this headline"></a></h3>
<p>Tosca types can declared a special class-level method called <code class="docutils literal notranslate"><span class="pre">_class_init</span></code> that is called when the class definition is being initialized. Inside this method, expressions that reference fields return references to the field definition, not its value, allowing you to customize the class definition in a context where your Python type checker (such as the IDE’s) has the class definition available.</p>
<p>This example creates sets the <code class="docutils literal notranslate"><span class="pre">node_filter</span></code> on the declared <code class="docutils literal notranslate"><span class="pre">host</span></code> requirement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">tosca</span><span class="w"> </span><span class="kn">import</span> <span class="n">in_range</span><span class="p">,</span> <span class="n">gb</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="p">(</span><span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Compute</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_class_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">in_range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">gb</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">gb</span><span class="p">)</span><span class="o">.</span><span class="n">apply_constraint</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">mem_size</span><span class="p">)</span>
</pre></div>
</div>
<p>And will be translated to YAML as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">node_types</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Example</span><span class="p">:</span>
<span class="w">    </span><span class="nt">derived_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Root</span>
<span class="w">    </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span>
<span class="w">        </span><span class="nt">node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">        </span><span class="nt">node_filter</span><span class="p">:</span>
<span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span>
<span class="w">              </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mem_size</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">in_range</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2 GB</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20 GB</span>
</pre></div>
</div>
<p>Note that your IDE’s type checker will highlight an error if the <code class="docutils literal notranslate"><span class="pre">mem_size</span></code>’s type was incompatible with the values passed to <code class="docutils literal notranslate"><span class="pre">in_range</span></code>.</p>
</section>
<section id="names-and-identifiers">
<h3>Names and Identifiers<a class="headerlink" href="#names-and-identifiers" title="Permalink to this headline"></a></h3>
<p>TOSCA’s YAML syntax allows names that are not valid Python identifiers so the DSL’s APIs let you provide an alternative name for types, templates, fields, and operations, etc. which will used when generating YAML – whose those if the TOSCA name is not a valid <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#identifiers">Python identifier</a> or if the name starts with a <code class="docutils literal notranslate"><span class="pre">_</span></code>.  Names that starts with <code class="docutils literal notranslate"><span class="pre">_</span></code> are reserved for internal use by your DSL classes and are ignored when generating YAML. When converting YAML to Python the code generator will generate Python code that preserves non-conforming names as needed.</p>
</section>
<section id="imports-and-repositories">
<h3>Imports and Repositories<a class="headerlink" href="#imports-and-repositories" title="Permalink to this headline"></a></h3>
<p>We translate TOSCA imports statements as relative imports in Python or, if a repository was specified, as a Python import in a package named “tosca_repositories.&lt;repository_name&gt;”. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">imports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.yaml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.yaml</span>
<span class="w">      </span><span class="nt">namespace_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ns</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.yaml</span>
<span class="w">      </span><span class="nt">namespace_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../bar/foo.yaml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo.yaml</span>
<span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_repo</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar/foo.yaml</span>
<span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_repo</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar/foo.yaml</span>
<span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_repo</span>
<span class="w">      </span><span class="nt">namespace_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
</pre></div>
</div>
<p>will be translated to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">.foo</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">foo</span> <span class="k">as</span> <span class="n">ns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">foo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..bar.foo</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tosca_repositories.my_repo.bar.foo</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tosca_repositories.my_repo.bar</span><span class="w"> </span><span class="kn">import</span> <span class="n">foo</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">export</span></code> will resolve imports from a repository by creating a<code class="docutils literal notranslate"><span class="pre">tosca_repositories</span></code> directory with a symlink to the location of the repository. This enables compatibility with IDEs that rely on simple file system path mapping to resolve Python imports.</p>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"></a></h2>
<section id="yaml-to-python">
<h3>YAML to Python<a class="headerlink" href="#yaml-to-python" title="Permalink to this headline"></a></h3>
<p>This example converts the “service_template.yaml” to Python and save the result at “service_template.py”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tosca.yaml2python</span><span class="w"> </span><span class="kn">import</span> <span class="n">yaml_to_python</span>

<span class="c1"># yaml_to_python() converts the given YAML service template to Python source code as a string and saves it to a file if a second file path is provided.</span>
<span class="n">python_src</span> <span class="o">=</span> <span class="n">yaml_to_python</span><span class="p">(</span><span class="s2">&quot;service_template.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;service_template.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are using unfurl, you can accomplish the same thing from the command line using:</p>
<p><code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">export</span> <span class="pre">--format</span> <span class="pre">python</span> <span class="pre">service_template.yaml</span></code></p>
<p>The following options affect the output of the generated Python code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">python</span><span class="o">-</span><span class="n">target</span> <span class="p">[</span><span class="mf">3.7</span><span class="o">|</span><span class="mf">3.8</span><span class="o">|</span><span class="mf">3.9</span><span class="o">|</span><span class="mf">3.10</span><span class="p">]</span>
                                  <span class="n">Python</span> <span class="n">version</span> <span class="n">to</span> <span class="n">target</span> <span class="p">(</span><span class="n">Default</span><span class="p">:</span> <span class="n">current</span> <span class="n">version</span><span class="p">)</span>
  <span class="o">--</span><span class="n">overwrite</span> <span class="p">[</span><span class="n">older</span><span class="o">|</span><span class="n">never</span><span class="o">|</span><span class="n">always</span><span class="o">|</span><span class="n">auto</span><span class="p">]</span>
                                  <span class="n">Overwrite</span> <span class="n">existing</span> <span class="n">files</span> <span class="p">(</span><span class="n">Default</span><span class="p">:</span> <span class="n">auto</span><span class="p">)</span>
</pre></div>
</div>
<p>The conversion process will follow TOSCA imports and generate Python files alongside the imported YAML files. The <code class="docutils literal notranslate"><span class="pre">--overwrite</span></code> option controls what happens when a file with the same name already exists; its values can be:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">older</span></code> will only overwrite the output file if it is older than the source file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">never</span></code> will never overwrite an existing file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">always</span></code> will always write the file even if one currently exists.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auto</span></code> (the default) will check if the existing file contains a generated comment at the beginning of the file. If The header comment is missing or the modified time included in the comment does not match the file’s modified time, the file will be skipped. This way files with manually modifications won’t be overwritten. To always allow a file to overwritten, edit the header to include the string “overwrite ok”.</p></li>
</ul>
</section>
<section id="python-to-yaml">
<h3>Python to YAML<a class="headerlink" href="#python-to-yaml" title="Permalink to this headline"></a></h3>
<p>This example does the reverse, saving the Python file as a YAML file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tosca_template</span> <span class="o">=</span> <span class="n">python_to_yaml</span><span class="p">(</span><span class="s2">&quot;service_template.py&quot;</span><span class="p">,</span> <span class="s2">&quot;service_template.yaml&quot;</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>With unfurl, the command line equivalent is:</p>
<p><code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">export</span> <span class="pre">service_template.py</span></code></p>
</section>
</section>
<section id="safe-mode">
<h2>Safe Mode<a class="headerlink" href="#safe-mode" title="Permalink to this headline"></a></h2>
<p>To enable untrusted Python service templates to be safely parsed in the same contexts as TOSCA YAML files, the <code class="docutils literal notranslate"><span class="pre">python_to_yaml</span></code> function has a <code class="docutils literal notranslate"><span class="pre">safe_mode</span></code> flag that will execute the Python code in a sandboxed environment. The following rules apply to code running in the sandbox:</p>
<ul class="simple">
<li><p>The sandbox only a provides a subset of Python’s built-ins functions and objects – ones that do not perform IO or modify global state.</p></li>
<li><p>Imports are limited to relative imports, TOSCA repositories via the  <code class="docutils literal notranslate"><span class="pre">tosca_repositories</span></code>, or the modules named in the <code class="docutils literal notranslate"><span class="pre">tosca.loader.ALLOWED_MODULES</span></code> list, which defaults to “base64”, “DateTime”, “math”,  (safe subset of)”os.path”, “random”, “re”, “string”, “tosca”, “typing”,  “typing_extensions”, “urllib.parse”, and “unfurl”.</p></li>
<li><p>If a module in the <code class="docutils literal notranslate"><span class="pre">ALLOWED_MODULES</span></code> has a <code class="docutils literal notranslate"><span class="pre">__safe__</span></code> attribute that is a list of names, only those attributes can be accessed by the sandboxed code. Otherwise only attributes listed in <code class="docutils literal notranslate"><span class="pre">__all__</span></code> can be accessed.</p></li>
<li><p>Modules in the <code class="docutils literal notranslate"><span class="pre">ALLOWED_MODULES</span></code> can not be modified, nor can objects, functions or classes declared in the module (this is enforced by checking the object <code class="docutils literal notranslate"><span class="pre">__module__</span></code> attribute).</p></li>
<li><p>All other modules imported have their contents executed in the same sandbox.</p></li>
<li><p>Disallowed imports will only raise <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> when an imported module’s attribute is accessed.</p></li>
<li><p>In safe mode, <code class="docutils literal notranslate"><span class="pre">python_to_yaml</span></code> will not invoke Python methods when convert operations to YAML. Since <code class="docutils literal notranslate"><span class="pre">ImportError</span></code>s are deferred until the imported module’s attributes are accessed, this allows safe mode to parse Python code with unsafe imports in global scope as long as they aren’t accessed while declaring types and templates in global scope.</p></li>
</ul>
<p>IMPORTANT CAVEATS:</p>
<ul class="simple">
<li><p>Safe mode does not attempt to protect against denial-of-service attacks.</p></li>
<li><p>The generated YAML should be treated as untrusted.</p></li>
</ul>
</section>
<section id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline"></a></h2>
<p>API Documentation can be found <a class="reference external" href="https://docs.unfurl.run/api.html#api-for-writing-service-templates">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tosca.html" class="btn btn-neutral float-left" title="TOSCA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="toscaref.html" class="btn btn-neutral float-right" title="TOSCA Language Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, OneCommons Co..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>