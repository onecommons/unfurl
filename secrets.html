<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Managing Secrets &mdash; Unfurl Documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon32.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Runtime Environment" href="runtime.html" />
    <link rel="prev" title="Repositories and Packages" href="packages.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/unfurl_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="solution-overview.html">Solution Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Unfurl Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembles.html">Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobs.html">Jobs and Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="tosca.html">TOSCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl.html">TOSCA as Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="toscaref.html">TOSCA Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Repositories and Packages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Managing Secrets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sensitive-values">Sensitive Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vault-secrets">Vault secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-secrets">Creating secrets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html">Configurators</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#installers">Installers</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#id38">Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing.html">Template Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="expressions.html">Expression Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloudmap.html">Cloud Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog for Unfurl</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Unfurl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Managing Secrets</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/secrets.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="managing-secrets">
<h1>Managing Secrets<a class="headerlink" href="#managing-secrets" title="Permalink to this headline"></a></h1>
<p>Unfurl allows you to store secrets separately from the rest for your configuration, either in separate configuration file or in a secrets manager such as HashiCorp Vault. In the project configuration file you specify how those secrets should be managed. You can apply the following strategies:</p>
<ul class="simple">
<li><p>Store the secrets in a local configuration file and distribute that file out-of-band if necessary.</p></li>
<li><p>Encrypt the secrets file using <a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/vault.html">Ansible Vault</a> so they can be safely checked into its git repository.</p></li>
<li><p>Store them in a secrets manager such as HashiCorp Vault or Amazon Secrets Manager or your OS’s keyring. You can use any secrets manager that has an <a class="reference external" href="https://docs.ansible.com/ansible/latest/plugins/lookup.html">Ansible Lookup Plugin</a> available for it.</p></li>
<li><p>If your git repository is private and the secrets not highly sensitive you can just commit it into the repository in plain text.</p></li>
</ul>
<p>You can apply any of these techniques to different secrets and projects can inherit the secrets configuration from <a class="reference internal" href="projects.html#unfurl-home"><span class="std std-ref">unfurl_home</span></a>.</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">secrets</span><span class="p">:</span>

<span class="w">    </span><span class="c1"># Include secrets from a file that will be automatically encrypted when committed to the repository:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">+?include</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets/secrets.yaml</span>

<span class="w">    </span><span class="c1"># include secrets from a file that will not be committed to the repository:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">+?include</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local/secrets.yaml</span>

<span class="w">    </span><span class="c1"># plaintext:</span>
<span class="w">    </span><span class="nt">not_so_secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>

<span class="w">    </span><span class="c1"># encrypted inlined:</span>
<span class="w">    </span><span class="nt">the_dev_secret</span><span class="p">:</span><span class="w"> </span><span class="kt">!vault</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">$ANSIBLE_VAULT;1.2;AES256;dev</span>
<span class="w">      </span><span class="no">30613233633461343837653833666333643061636561303338373661313838333565653635353162</span>
<span class="w">      </span><span class="no">3263363434623733343538653462613064333634333464660a663633623939393439316636633863</span>
<span class="w">      </span><span class="no">61636237636537333938306331383339353265363239643939666639386530626330633337633833</span>
<span class="w">      </span><span class="no">6664656334373166630a363736393262666465663432613932613036303963343263623137386239</span>
<span class="w">      </span><span class="no">6330</span>
<span class="w">    </span><span class="c1"># if secret isn&#39;t defined above look it up in a HashiCorp Vault instance</span>
<span class="w">    </span><span class="c1"># (assumes VAULT_TOKEN etc. environment variables are set)</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;hashi_vault&#39;,</span><span class="nv"> </span><span class="s">&#39;secret=&#39;+key)</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"> </span><span class="c1"># &quot;key&quot; will be set to the secret name</span>
</pre></div>
</div>
<section id="sensitive-values">
<h2>Sensitive Values<a class="headerlink" href="#sensitive-values" title="Permalink to this headline"></a></h2>
<p>You can mark configuration data as sensitive in their TOSCA definitions or by using the <a class="reference internal" href="expressions.html#sensitive"><span class="std std-ref">sensitive</span></a> expression function. When those values are saved in YAML, if you have Ansible Vault secret associated with your ensemble, their encrypted values will be embedded, if not, they will be saved as “&lt;&lt;&lt;Redacted&gt;&gt;&gt;”. When loading a YAML configuration file, any Vault data will be decrypted and any attribute with a value of “&lt;&lt;&lt;Redacted&gt;&gt;&gt;” will be omitted.</p>
</section>
<section id="vault-secrets">
<h2>Vault secrets<a class="headerlink" href="#vault-secrets" title="Permalink to this headline"></a></h2>
<p>When creating a new ensemble via a <code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">init</span></code> or <code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">clone</span></code>, if a new git repository is created (either because its a new project or because the ensemble uses a separate repository) will add a <code class="docutils literal notranslate"><span class="pre">vault_secrets</span></code> secret with a generated password to <code class="docutils literal notranslate"><span class="pre">local/unfurl.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">secrets/secrets.yaml</span></code> file added to the repository – see <a class="reference internal" href="projects.html#project-files"><span class="std std-ref">Project files</span></a>.</p>
<p>You can force this in any new project by passing the``VAULT_PASSWORD`` skeleton variable to <code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">init</span></code> or <code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">clone</span></code>. See <a class="reference internal" href="projects.html#vault-password-var"><span class="std std-ref">setting</span></a> for an example.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Store this master Vault password found in <code class="docutils literal notranslate"><span class="pre">local/unfurl.yaml</span></code> in a safe place!</p>
</div>
</section>
<section id="creating-secrets">
<h2>Creating secrets<a class="headerlink" href="#creating-secrets" title="Permalink to this headline"></a></h2>
<p>When <code class="docutils literal notranslate"><span class="pre">unfurl</span> <span class="pre">commit</span></code> commits changes to a project, any files in directories named <code class="docutils literal notranslate"><span class="pre">secrets</span></code> will automatically be encrypted with the project’s vault password and committed into a parallel directory named <code class="docutils literal notranslate"><span class="pre">.secrets</span></code>. When Unfurl starts it will automatically decrypt those files and restore them to their <code class="docutils literal notranslate"><span class="pre">secrets</span></code> directory.</p>
<p>To create secrets manually (for example, to use inline as shown in the example above), you can use the <code class="docutils literal notranslate"><span class="pre">unfurl-vault-client</span></code> script with the <code class="docutils literal notranslate"><span class="pre">ansible-vault</span></code> command. The <code class="docutils literal notranslate"><span class="pre">unfurl-vault-client</span></code> script outputs the vault password for the current project so you can encrypt secrets using the <code class="docutils literal notranslate"><span class="pre">ansible-vault</span></code> utility like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">vault</span> <span class="n">encrypt_string</span> <span class="o">--</span><span class="n">vault</span><span class="o">-</span><span class="nb">id</span> <span class="n">default</span><span class="nd">@unfurl</span><span class="o">-</span><span class="n">vault</span><span class="o">-</span><span class="n">client</span> <span class="s2">&quot;secret1&quot;</span> <span class="s2">&quot;secret2&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="packages.html" class="btn btn-neutral float-left" title="Repositories and Packages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="runtime.html" class="btn btn-neutral float-right" title="Runtime Environment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, OneCommons Co..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>