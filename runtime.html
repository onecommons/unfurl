<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Runtime Environment &mdash; Unfurl Documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon32.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configurators" href="configurators.html" />
    <link rel="prev" title="Managing Secrets" href="secrets.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/unfurl_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="solution-overview.html">Solution Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Unfurl Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembles.html">Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobs.html">Jobs and Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="tosca.html">TOSCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl.html">TOSCA as Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="toscaref.html">TOSCA Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Repositories and Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="secrets.html">Managing Secrets</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Runtime Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#job-variables">Job Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#task-keys"><code class="docutils literal notranslate"><span class="pre">task</span></code> Keys</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#connections">Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#topology-inputs">Topology Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-unfurl">Debugging Unfurl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html">Configurators</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#installers">Installers</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#configurators-artifacts">Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing.html">Template Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="expressions.html">Expression Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloudmap.html">Cloud Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog for Unfurl</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Unfurl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Runtime Environment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/runtime.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="runtime-environment">
<h1>Runtime Environment<a class="headerlink" href="#runtime-environment" title="Permalink to this headline"></a></h1>
<p>The following sections describe the runtime environment when Unfurl is executing an operation in a job.</p>
<section id="job-variables">
<h2>Job Variables<a class="headerlink" href="#job-variables" title="Permalink to this headline"></a></h2>
<p>When a <a class="reference internal" href="glossary.html#tasks"><span class="std std-ref">task</span></a> is being evaluated the following variables are available as an <a class="reference internal" href="processing.html#eval-expressions"><span class="std std-ref">expression</span></a> variable or a jinja2 template variable.
Instances are represented as a dictionary containing its properties and attributes and its <a class="reference internal" href="expressions.html#special-keys"><span class="std std-ref">Special keys</span></a>.</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">implementation</dt>
<dd class="field-odd"><p>The artifact used by the operation’s implementation (or null if one wasn’t set).</p>
</dd>
<dt class="field-even">inputs</dt>
<dd class="field-even"><p>A dictionary containing the inputs declared on the task’s operation.</p>
</dd>
<dt class="field-odd">arguments</dt>
<dd class="field-odd"><p>A dictionary containing inputs and properties passed to task’s <a class="reference internal" href="glossary.html#artifact"><span class="std std-ref">Artifact</span></a>.</p>
</dd>
<dt class="field-even">connections</dt>
<dd class="field-even"><p>See <a class="reference internal" href="#connections"><span class="std std-ref">Connections</span></a> below.</p>
</dd>
<dt class="field-odd">SELF</dt>
<dd class="field-odd"><p>The current task’s target instance.</p>
</dd>
<dt class="field-even">Self</dt>
<dd class="field-even"><p>The <a class="reference internal" href="CHANGELOG.html#python-dsl"><span class="std std-ref">Python DSL</span></a> <a class="reference internal" href="api.html#tosca.ToscaType" title="tosca.ToscaType"><code class="xref any py py-class docutils literal notranslate"><span class="pre">object</span></code></a> representing <code class="docutils literal notranslate"><span class="pre">SELF</span></code> if one was defined, or null.</p>
</dd>
<dt class="field-odd">HOST</dt>
<dd class="field-odd"><p>The host of SELF.</p>
</dd>
<dt class="field-even">ORCHESTRATOR</dt>
<dd class="field-even"><p>The instance Unfurl is running on (<code class="docutils literal notranslate"><span class="pre">localhost</span></code>)</p>
</dd>
<dt class="field-odd">OPERATION_HOST</dt>
<dd class="field-odd"><p>Current task’s <code class="docutils literal notranslate"><span class="pre">operation_host</span></code>. If it is not declared, defaults to <code class="docutils literal notranslate"><span class="pre">localhost</span></code>.</p>
</dd>
<dt class="field-even">SOURCE</dt>
<dd class="field-even"><p>If the task’s target instance is a relationship, its source instance</p>
</dd>
<dt class="field-odd">TARGET</dt>
<dd class="field-odd"><p>If the task’s target instance is a relationship, its target instance</p>
</dd>
<dt class="field-even">task</dt>
<dd class="field-even"><p>A dictionary containing the current task’s settings. Its keys include:</p>
</dd>
</dl>
</div></blockquote>
<section id="task-keys">
<h3><code class="docutils literal notranslate"><span class="pre">task</span></code> Keys<a class="headerlink" href="#task-keys" title="Permalink to this headline"></a></h3>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">cwd</dt>
<dd class="field-odd"><p>The current working directory the task process is executing in.</p>
</dd>
<dt class="field-even">dryrun</dt>
<dd class="field-even"><p>(boolean) Whether the current job has the <code class="docutils literal notranslate"><span class="pre">--dryrun</span></code> flag set.</p>
</dd>
<dt class="field-odd">name</dt>
<dd class="field-odd"><p>Name of the current task</p>
</dd>
<dt class="field-even">operation</dt>
<dd class="field-even"><p>The name of the operation the task is running.</p>
</dd>
<dt class="field-odd">reason</dt>
<dd class="field-odd"><p><a class="reference internal" href="api.html#unfurl.support.Reason" title="unfurl.support.Reason"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Reason</span></code></a> the current task was selected, e.g. “add”, “update”, “prune”, “repair”</p>
</dd>
<dt class="field-even">target</dt>
<dd class="field-even"><p>The name of the instance that the task is operating on.</p>
</dd>
<dt class="field-odd">timeout</dt>
<dd class="field-odd"><p>The task’s timeout value if set,</p>
</dd>
<dt class="field-even">verbose</dt>
<dd class="field-even"><p>An integer indicating log verbosity level: 0 (INFO) (the default), -1 CRITICAL (set by <code class="docutils literal notranslate"><span class="pre">--quiet</span></code>), &gt;= 1 DEBUG (set by <code class="docutils literal notranslate"><span class="pre">-v</span></code>, <code class="docutils literal notranslate"><span class="pre">-vv</span></code>, or <code class="docutils literal notranslate"><span class="pre">-vvv</span></code>)</p>
</dd>
<dt class="field-odd">workflow</dt>
<dd class="field-odd"><p>The current workflow (e.g. <code class="docutils literal notranslate"><span class="pre">deploy</span></code>, <code class="docutils literal notranslate"><span class="pre">undeploy</span></code>, or <code class="docutils literal notranslate"><span class="pre">discover</span></code>)</p>
</dd>
</dl>
</div></blockquote>
</section>
</section>
<section id="connections">
<h2>Connections<a class="headerlink" href="#connections" title="Permalink to this headline"></a></h2>
<p>In order to execute operations on a resource Unfurl often needs connection settings,
in particular credentials for authorization. These settings could be
passed as inputs to each operation that needs them but this can be repetitive and inflexible. Instead you can define <a class="reference internal" href="toscaref/spec-relationship-templates.html#relationship-templates"><span class="std std-ref">Relationship Templates</span></a> that are globally available to operations. Their properties can be accessed through <code class="docutils literal notranslate"><span class="pre">connections</span></code> job variable or automatically exposed as <a class="reference internal" href="#environment-variables"><span class="std std-ref">Environment Variables</span></a> as described in that section.
They can also be accessed through the <a class="reference internal" href="expressions.html#find-connection"><span class="std std-ref">find_connection</span></a> expression function or <a class="reference internal" href="api.html#unfurl.tosca_plugins.expr.find_connection" title="unfurl.tosca_plugins.expr.find_connection"><code class="xref py py-func docutils literal notranslate"><span class="pre">unfurl.tosca_plugins.expr.find_connection()</span></code></a>.</p>
<p>You can define connections in the following ways:</p>
<ul class="simple">
<li><p>In the <a class="reference internal" href="toscaref/spec-relationship-templates.html#relationship-templates"><span class="std std-ref">Relationship Templates</span></a> section of your TOSCA service template.</p></li>
<li><p>In the <a class="reference internal" href="#connections"><span class="std std-ref">Connections</span></a> section of the ensemble’s environment.</p></li>
<li><p>On the source node template by defining a requirement with inline relationship with <code class="docutils literal notranslate"><span class="pre">default_for</span></code> set to “SELF”.</p></li>
<li><p>Imported from an external ensemble by setting the <code class="docutils literal notranslate"><span class="pre">connections</span></code> key in the <a class="reference internal" href="projects.html#external-ensembles"><span class="std std-ref">External ensembles</span></a> section. The imported connections are added to the main ensemble’s default connections. This allows the main ensemble to connect to resources in the imported ensemble, For example, a Kubernetes cluster. Its value is a list of names of the relationship templates to import from the external ensemble. To import connections defined inline in a requirement on a node template use <code class="docutils literal notranslate"><span class="pre">&lt;instance_name&gt;::&lt;requirement_name&gt;</span></code> as the name.</p></li>
<li><p>Added by a operation at runtime via a <a class="reference internal" href="configurators.html#resulttemplate"><span class="std std-ref">resultTemplate</span></a> or the <a class="reference internal" href="api.html#unfurl.configurator.TaskView.update_instances" title="unfurl.configurator.TaskView.update_instances"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">TaskView.update_instances()</span></code></a> method.</p></li>
</ul>
<p>A relationship template is treated as a connection when it has the <code class="docutils literal notranslate"><span class="pre">default_for</span></code> key set. If this key is present, it indicates that the relationship template doesn’t need to be explicitly referenced in the <code class="docutils literal notranslate"><span class="pre">requirements</span></code> section of a node template as regular relationship templates
must be, but instead is applied to any target node that matches the relationship type’s specification.</p>
<p>To determine if a connection is available to a task, the <code class="docutils literal notranslate"><span class="pre">default_for</span></code> value is evaluated against the task’s target node and capability and all of the target node’s HOST ancestors. The <code class="docutils literal notranslate"><span class="pre">default_for</span></code> key can be set to one of the following values:</p>
<ul class="simple">
<li><p>“ANY”</p></li>
<li><p>“SELF” (when set inline in a requirement)</p></li>
<li><p>the name of a node template</p></li>
<li><p>the name of a node type</p></li>
<li><p>the name of a capability</p></li>
<li><p>the name of a capability type</p></li>
</ul>
<p>In additions to these global connections, if an <a class="reference external" href="_static/TOSCA-Simple-Profile-YAML-v1.3-os-toc.html#_Toc50125294">OPERATION_HOST</a> or <a class="reference internal" href="projects.html#the-localhost-ensemble"><span class="std std-ref">The Localhost Ensemble</span></a> is defined, any explicit relationship templates defined between that node and the target node or the target node’s HOST nodes will be added.</p>
<p>The connections available to a task are exposed though the <code class="docutils literal notranslate"><span class="pre">connections</span></code> job variable as a map where the keys are the name of the relationship template or the name of the type of the relationship.</p>
<p>For example, these expressions all evaluate to the same value:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">&quot;$connections::aws::AWS_ACCESS_KEY_ID&quot;</span> <span class="pre">|</span> <span class="pre">eval</span> <span class="pre">}}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">&quot;$connections::AWSAccount::AWS_ACCESS_KEY_ID&quot;</span> <span class="pre">|</span> <span class="pre">eval</span> <span class="pre">}}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">&quot;$connections::*::AWS_ACCESS_KEY_ID&quot;</span> <span class="pre">|</span> <span class="pre">eval</span> <span class="pre">}}</span></code></p>
</div></blockquote>
<p>In addition, because the property <code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code> is marked as an environment variable in the relationship’s type definition, it will also be added to the environment when the operation executed.</p>
</section>
<section id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline"></a></h2>
<p>Each task has its own isolated set of environment variables that can be access via the <a class="reference internal" href="expressions.html#get-env"><span class="std std-ref">get_env</span></a> expression function or the <a class="reference internal" href="api.html#unfurl.configurator.TaskView.environ" title="unfurl.configurator.TaskView.environ"><code class="xref any py py-attr docutils literal notranslate"><span class="pre">TaskView.environ</span></code></a> property.
Configurators that spawn processes like <a class="reference internal" href="configurators.html#shell"><span class="std std-ref">Shell</span></a> will use this to set the process’s environment.</p>
<p>The environment is set as follows:</p>
<ol class="arabic simple">
<li><p>Copy the environment variables associated with the Unfurl process.</p></li>
<li><p>Apply the rules in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> section in the ensemble’s <a class="reference internal" href="jsonschema.html#environment"><span class="std std-ref">environment</span></a>.</p></li>
<li><p>Add variables set by the connections that are available to this operation. Any property whose definition has <code class="docutils literal notranslate"><span class="pre">env_var</span></code> metadata set are added as environment variables. Unfurl’s type definitions sets the common environment variables for cloud providers, for example <code class="docutils literal notranslate"><span class="pre">KUBECONFIG</span></code> or <code class="docutils literal notranslate"><span class="pre">GOOGLE_APPLICATION_CREDENTIALS</span></code>.</p></li>
<li><p>Apply the rules declared in the <code class="docutils literal notranslate"><span class="pre">environment</span></code> section of the operation’s <a class="reference internal" href="tosca.html#implementation"><span class="std std-ref">Implementation</span></a> definition.</p></li>
<li><p>The operation can invoke the <a class="reference internal" href="expressions.html#to-env"><span class="std std-ref">to_env</span></a> expression function (or <a class="reference internal" href="api.html#unfurl.tosca_plugins.expr.to_env" title="unfurl.tosca_plugins.expr.to_env"><code class="xref py py-func docutils literal notranslate"><span class="pre">unfurl.tosca_plugins.expr.to_env()</span></code></a>) to update environment variables.</p></li>
</ol>
<p>When applying rules, Unfurl makes a copy of the current environment and applied each of its keys
in the order they are declared, adding the given key and value as
environment variables except keys starting with “+” and “-”
will copy or remove the variable from the current into environment
into the new one. In that case “*” and “?” are treated like filename wildcards and “!” negates the match:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class="w">    </span><span class="c1"># set name=value</span>
<span class="nt">+name</span><span class="p">:</span><span class="w">         </span><span class="c1"># copy name into the enviroment</span>
<span class="nt">+name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"> </span><span class="c1"># copy value, set it to &quot;default&quot; if not present</span>
<span class="nt">+prefix*</span><span class="p">:</span><span class="w">      </span><span class="c1"># copy all variables matching &quot;prefix*&quot;</span>
<span class="nt">+!prefix*</span><span class="p">:</span><span class="w">     </span><span class="c1"># copy all except variables matching &quot;prefix*&quot;</span>
<span class="nt">-!name</span><span class="p">:</span><span class="w">        </span><span class="c1"># remove all except name</span>
<span class="nt">-!prefix*</span><span class="p">:</span><span class="w">     </span><span class="c1"># remove all except variables matching &quot;prefix*&quot;</span>
<span class="nt">^name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class="w">   </span><span class="c1"># treat name like a PATH and prepend value: e.g. /bin:$name</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">environment</span><span class="p">:</span>
<span class="w">   </span><span class="nt">-*</span><span class="p">:</span><span class="w">       </span><span class="c1"># this will remove all environment variables</span>
<span class="w">   </span><span class="nt">+HOME</span><span class="p">:</span><span class="w">    </span><span class="c1"># add HOME back</span>
<span class="w">   </span><span class="nt">FOO</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span><span class="w">  </span><span class="c1"># set FOO = bar</span>
<span class="w">   </span><span class="nt">^PATH</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin</span><span class="w"> </span><span class="c1"># set PATH to /bin:$PATH</span>
</pre></div>
</div>
<p>Values are converted to strings as follows:
If the value is null the rule is skipped.
If the value is a boolean, it is converted to “true” or “” if false.
Otherwise, it is converted to a string.
Patterns like <code class="docutils literal notranslate"><span class="pre">${NAME}</span></code> or <code class="docutils literal notranslate"><span class="pre">${NAME:default</span> <span class="pre">value}</span></code> in the value will be substituted with the value of the environment variable <code class="docutils literal notranslate"><span class="pre">$NAME</span></code>. Use <code class="docutils literal notranslate"><span class="pre">\${NAME}</span></code> to ignore.</p>
<p>The following environment variables will always be copied from the parent environment unless explicitly removed or set:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ASDF_DATA_DIR</p></td>
</tr>
<tr class="row-odd"><td><p>CURL_CA_BUNDLE</p></td>
</tr>
<tr class="row-even"><td><p>PATH</p></td>
</tr>
<tr class="row-odd"><td><p>LANG</p></td>
</tr>
<tr class="row-even"><td><p>LANGUAGE</p></td>
</tr>
<tr class="row-odd"><td><p>LD_LIBRARY_PATH</p></td>
</tr>
<tr class="row-even"><td><p>REQUESTS_CA_BUNDLE</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CERT_FILE</p></td>
</tr>
<tr class="row-even"><td><p>HTTP_PROXY</p></td>
</tr>
<tr class="row-odd"><td><p>HTTPS_PROXY</p></td>
</tr>
<tr class="row-even"><td><p>NO_PROXY</p></td>
</tr>
<tr class="row-odd"><td><p>PYTHONPATH</p></td>
</tr>
<tr class="row-even"><td><p>TMPDIR</p></td>
</tr>
<tr class="row-odd"><td><p>VIRTUAL_ENV</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_TMPDIR</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_LOGGING</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_HOME</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_RUNTIME</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_NORUNTIME</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_APPROVE</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_MOCK_DEPLOY</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_LOGFILE</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_CHECK_UPSTREAM</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_SKIP_UPSTREAM_CHECK</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_SKIP_VAULT_DECRYPT</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_SKIP_SAVE</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_SEARCH_ROOT</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_CLOUD_SERVER</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_VALIDATION_MODE</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_PACKAGE_RULES</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_LOG_FORMAT</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_LOG_TRUNCATE</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_RAISE_LOGGING_EXCEPTIONS</p></td>
</tr>
<tr class="row-odd"><td><p>PY_COLORS</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_OVERWRITE_POLICY</p></td>
</tr>
<tr class="row-odd"><td><p>UNFURL_EXPORT_LOCALNAMES</p></td>
</tr>
<tr class="row-even"><td><p>UNFURL_GLOBAL_NAMESPACE_PACKAGES</p></td>
</tr>
</tbody>
</table>
<p>If the <code class="docutils literal notranslate"><span class="pre">ASDF_DATA_DIR</span></code> environment variable is set or the <code class="docutils literal notranslate"><span class="pre">https://github.com/asdf-vm/asdf.git</span></code> repository is part of a current project
and a <code class="docutils literal notranslate"><span class="pre">.tool-versions</span></code> file exists (or <code class="docutils literal notranslate"><span class="pre">$ASDF_DEFAULT_TOOL_VERSIONS_FILENAME</span></code>) in the root of a current project, then <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable will be configured to include the paths to the tools listed in that file.</p>
</section>
<section id="topology-inputs">
<h2>Topology Inputs<a class="headerlink" href="#topology-inputs" title="Permalink to this headline"></a></h2>
<p>Topology <a class="reference internal" href="toscaref/spec-inputs.html#inputs"><span class="std std-ref">Inputs</span></a> are parameters passed to a service template when it is instantiated. They made available at runtime via the <a class="reference internal" href="expressions.html#get-input"><span class="std std-ref">get_input</span></a> expression function.</p>
<p>Inputs can come from any of the following sources, and are merged together:</p>
<ul>
<li><p>The <a class="reference internal" href="jsonschema.html#id1"><span class="std std-ref">spec/inputs</span></a> section of the ensemble’s manifest. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</li>
<li><p>As a TOSCA extension, in the <code class="docutils literal notranslate"><span class="pre">inputs_values</span></code> section of the service template. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inputs_values</span><span class="p">:</span>
<span class="w">      </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
</li>
<li><p>When creating or cloning an ensemble, the default <a class="reference internal" href="projects.html#project-skeletons"><span class="std std-ref">project skeleton</span></a> will write inputs into this section using skeleton variables that start with <code class="docutils literal notranslate"><span class="pre">input_</span></code>, for example, this command will render the yaml in the example above:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>unfurl<span class="w"> </span>init<span class="w"> </span>--var<span class="w"> </span>input_foo<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="projects.html#environment-inputs"><span class="std std-ref">Inputs section</span></a> of the current environment.</p></li>
<li><p>From the command line:</p></li>
</ul>
<p>You can add or override inputs when a job is run from the command line by passing job vars that start with <code class="docutils literal notranslate"><span class="pre">input_</span></code>. For example, deploying with this command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>unfurl<span class="w"> </span>deploy<span class="w"> </span>--var<span class="w"> </span>input_foo<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>will set <code class="docutils literal notranslate"><span class="pre">foo</span></code> to 1, overriding <code class="docutils literal notranslate"><span class="pre">spec\inputs</span></code>.</p>
<p>Note that inputs passed via <code class="docutils literal notranslate"><span class="pre">--var</span></code> on the command line as parsed as YAML strings, as if they were embedded in the ensemble’s YAML file.</p>
</section>
<section id="debugging-unfurl">
<h2>Debugging Unfurl<a class="headerlink" href="#debugging-unfurl" title="Permalink to this headline"></a></h2>
<p>The following environment variables can be set to enable debugging features and diagnostic output:</p>
<dl class="simple">
<dt><strong>UNFURL_DEBUGPY</strong></dt><dd><p>Set to a port number (or “1” to use default port 5678) to wait for a remote debugger (like VS-Code) to attach on startup. Requires <a class="reference external" href="https://pypi.org/project/debugpy/">debugpy</a> to be installed.</p>
</dd>
<dt><strong>UNFURL_TEST_PRINT_YAML_SRC</strong></dt><dd><p>Prints the YAML source generated when DSL Python is converted to TOSCA YAML.</p>
</dd>
<dt><strong>UNFURL_TEST_PRINT_AST_SRC</strong></dt><dd><p>When the TOSCA DSL imports loader executes Python code, convert the processed Python Abstract Syntax Tree (AST) back to Python source code and  print it. Helpful to debug exceptions raised from user-defined Python DSL templates, which might not have the source code reported in the exception stack trace.</p>
</dd>
<dt><strong>UNFURL_TEST_DUMP_SOLVER</strong></dt><dd><p>Set to “1” or “2” to enable diagnostic output from the TOSCA solver when performs model inference.</p>
<ul class="simple">
<li><p>“1”: Prints nodes, requirements, requirement matches, property expressions, property matches, term matches, queries (final), and query results</p></li>
<li><p>“2”: Additionally prints relationships, queries (intermediate), results (intermediate), and transitive matches</p></li>
</ul>
</dd>
<dt><strong>UNFURL_TEST_SAFE_LOADER</strong></dt><dd><p>When set to “never”, disable the safe mode sandbox unconditionally. Any other non-empty value enables safe mode unconditionally.</p>
</dd>
<dt><strong>UNFURL_TEST_SKIP_LOADER</strong></dt><dd><p>If set, disable the TOSCA DSL imports loader. The imports loader can sometimes confuse an interactive Python debugger, only use this in those scenarios.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="secrets.html" class="btn btn-neutral float-left" title="Managing Secrets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configurators.html" class="btn btn-neutral float-right" title="Configurators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, OneCommons Co..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>