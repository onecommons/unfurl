<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started &mdash; Unfurl Documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon32.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/unfurl_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="solution-overview.html">Solution Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Unfurl Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembles.html">Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobs.html">Jobs and Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="tosca.html">TOSCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl.html">TOSCA as Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="toscaref.html">TOSCA Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Repositories and Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="secrets.html">Managing Secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Runtime Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html">Configurators</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#installers">Installers</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurators.html#id38">Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing.html">Template Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="expressions.html">Expression Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloudmap.html">Cloud Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog for Unfurl</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Unfurl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Getting Started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/get-started-step-by-step.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h1>
<p>Once you’ve installed <a class="reference internal" href="cli.html#unfurl"><span class="std std-ref">unfurl</span></a>, you are ready to configure it and create your first Unfurl project.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Before diving in, it is recommended that you read this high-level overview of <a class="reference external" href="https://unfurl.run/howitworks.html">How it works</a> section.</p>
</div>
<section id="create-a-service-template">
<span id="create-servicetemplate"></span><h2>3. Create a service template<a class="headerlink" href="#create-a-service-template" title="Permalink to this headline"></a></h2>
<p>If you look at <a class="reference internal" href="jsonschema.html#id1"><span class="std std-ref">ensemble_template.yaml</span></a>, you’ll see that it contains a minimal template with one node template and one workflow.
Workflows are optional but defining one is the simplest way to get started,
because you just need to declare procedural steps instead of designing model of your topology.</p>
<p>Topology and Orchestration Specification for Cloud Applications (TOSCA) is an OASIS standard language to describe a topology of cloud based web services,
their components, relationships, and the processes that manage them.
The TOSCA standard includes specifications to describe processes that create or modify web services. You can read more about it on the OASIS website.</p>
<p>You can find examples</p>
<p><a class="reference external" href="https://github.com/oasis-open/tosca-community-contributions/tree/master/examples/1.3/tutorial">https://github.com/oasis-open/tosca-community-contributions/tree/master/examples/1.3/tutorial</a></p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-YAML" for="sd-tab-item-0">
YAML</label><div class="sd-tab-content docutils">
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unfurl/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensemble</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">topology_template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">node_templates</span><span class="p">:</span>
<span class="w">          </span><span class="nt">my_server</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">              </span><span class="c1"># Host container properties</span>
<span class="w">              </span><span class="nt">host</span><span class="p">:</span>
<span class="w">                </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">num_cpus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">                  </span><span class="nt">disk_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200GB</span>
<span class="w">                  </span><span class="nt">mem_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512MB</span>
<span class="w">              </span><span class="c1"># Guest Operating System properties</span>
<span class="w">              </span><span class="nt">os</span><span class="p">:</span>
<span class="w">                </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">                  </span><span class="c1"># host Operating System image properties</span>
<span class="w">                  </span><span class="nt">architecture</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x86_64</span>
<span class="w">                  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
<span class="w">                  </span><span class="nt">distribution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">                  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">focal</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-python" for="sd-tab-item-1">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_server</span> <span class="o">=</span> <span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Compute</span><span class="p">(</span>
<span class="s2">&quot;my_server&quot;</span><span class="p">,</span>
<span class="n">host</span><span class="o">=</span><span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">Compute</span><span class="p">(</span>
    <span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">disk_size</span><span class="o">=</span><span class="mi">200</span> <span class="o">*</span> <span class="n">GB</span><span class="p">,</span>
    <span class="n">mem_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span>
  <span class="p">),</span>
<span class="n">os</span><span class="o">=</span><span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">OperatingSystem</span><span class="p">(</span>
    <span class="n">architecture</span><span class="o">=</span><span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linux&quot;</span><span class="p">,</span>
    <span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="n">tosca_version</span><span class="p">(</span><span class="s2">&quot;focal&quot;</span><span class="p">),</span>
  <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="implementing-an-operation">
<span id="implement-operation"></span><h2>4. Implementing an operation<a class="headerlink" href="#implementing-an-operation" title="Permalink to this headline"></a></h2>
<p>Of course, we don’t have enough information “my_server” to actually create a compute instance – it could be, for example, a physical machine, a virtual machine, a docker image or Kubernetes pod.
“my_server” are a set of abstract constraints that be applied to any number of</p>
<p>It is the implementation that create (or discover) instances that conforms to this specification.
Implementations are defined by specifying how to carry out operations that are applied to the node templates.
TOSCA defines a vocabulary of a few standard operations such as “create” or “delete” and you can define your own.
Their implementations can be a simple as the name of a shell script to invoke or yaml specification that is passed to a <a class="reference internal" href="api.html#module-unfurl.configurator" title="unfurl.configurator"><code class="xref any py py-mod docutils literal notranslate"><span class="pre">configurator</span></code></a>,
which is Unfurl’s plugin system for implementing operations.
Unfurl ships with several configurators, including ones for Ansible, Terraform and Kubernetes.</p>
<p>We can implement <code class="docutils literal notranslate"><span class="pre">my_server</span></code> in just few lines of YAML by Google Cloud Platform by calling the <code class="docutils literal notranslate"><span class="pre">gcloud</span></code> tool.
We’ll start with “delete” to make the</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-YAML" for="sd-tab-item-2">
YAML</label><div class="sd-tab-content docutils">
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unfurl/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensemble</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">  </span><span class="nt">topology_template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_templates</span><span class="p">:</span>
<span class="w">      </span><span class="nt">my_server</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">        </span><span class="c1"># details omitted, see example above</span>
<span class="w">        </span><span class="nt">interfaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">Standard</span><span class="p">:</span>
<span class="w">            </span><span class="nt">delete</span><span class="p">:</span>
<span class="w">              </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcloud compute instances delete {{ &#39;.name&#39; | eval }}</span>
<span class="w">          </span><span class="c1"># ... see example below for more operations</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-python" for="sd-tab-item-3">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_delete</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span><span class="s2">&quot;gcloud compute instances delete {{ &#39;.name&#39; | eval }}&quot;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">my_server</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="n">my_server_delete</span>
</pre></div>
</div>
</div>
</div>
<p>Creates a little more verbose and illustrates how to pass input parameters and set attributes on the instance created from a template:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-YAML" for="sd-tab-item-4">
YAML</label><div class="sd-tab-content docutils">
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unfurl/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensemble</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">topology_template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">node_templates</span><span class="p">:</span>
<span class="w">        </span><span class="nt">my_server</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">          </span><span class="c1"># details omitted, see example above</span>
<span class="w">          </span><span class="nt">interfaces</span><span class="p">:</span>
<span class="w">            </span><span class="nt">Standard</span><span class="p">:</span>
<span class="w">              </span><span class="nt">delete</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcloud compute instances delete {{ &#39;.name&#39; | eval }}</span>
<span class="w">              </span><span class="nt">create</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">                  </span><span class="no">gcloud compute instances create {{ &#39;.name&#39; | eval }}</span>
<span class="w">                    </span><span class="no">--boot-disk-size={{ {&quot;get_property&quot;: [&quot;SELF&quot;, &quot;host&quot;, &quot;disk_size&quot;]} | eval | regex_replace(&quot; &quot;) }}</span>
<span class="w">                    </span><span class="no">--image=$(gcloud compute images list --filter=name:{{ {&#39;get_property&#39;: [&#39;SELF&#39;, &#39;os&#39;, &#39;distribution&#39;]} | eval }}</span>
<span class="w">                          </span><span class="no">--filter=name:focal --limit=1 --uri)</span>
<span class="w">                    </span><span class="no">--machine-type=e2-medium   &gt; /dev/null</span>
<span class="w">                  </span><span class="no">&amp;&amp; gcloud compute instances describe {{ &#39;.name&#39; | eval }} --format=json</span>
<span class="w">                </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">resultTemplate</span><span class="p">:</span>
<span class="w">                    </span><span class="c1"># recursively merge the map with the yaml anchor &quot;gcloudStatusMap&quot;</span>
<span class="w">                    </span><span class="nt">+*gcloudStatusMap</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">eval</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">                        </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">public_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.networkInterfaces[0].accessConfigs[0].natIP</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">private_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.networkInterfaces[0].networkIP</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">zone</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.zone</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">basename</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">id</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.selfLink</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                </span><span class="c1"># ...  see below</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-python" for="sd-tab-item-5">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_delete</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span><span class="s2">&quot;gcloud compute instances delete {{ &#39;.name&#39; | eval }}&quot;</span><span class="p">),</span>
    <span class="p">)</span>


<span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;create&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_create</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;gcloud compute instances create {{ &#39;.name&#39; | eval }}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s1">&#39;--boot-disk-size={{ {&quot;get_property&quot;: [&quot;SELF&quot;, &quot;host&quot;, &quot;disk_size&quot;]} | eval | &#39;</span>
                <span class="s1">&#39;regex_replace(&quot; &quot;) }}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s2">&quot;--image=$(gcloud compute images list --filter=name:{{ {&#39;get_property&#39;: &quot;</span>
                <span class="s2">&quot;[&#39;SELF&#39;, &#39;os&#39;, &#39;distribution&#39;]} | eval }}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;      --filter=name:focal --limit=1 --uri)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;--machine-type=e2-medium   &gt; /dev/null</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&amp;&amp; gcloud compute instances describe {{ &#39;.name&#39; | eval }} --format=json</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">resultTemplate</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;eval&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="s2">&quot;$result&quot;</span>
                    <span class="s2">&quot;then&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;public_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ &quot;</span>
                            <span class="s2">&quot;result.networkInterfaces[0].accessConfigs[0].natIP &quot;</span>
                            <span class="s2">&quot;}}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;private_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ &quot;</span>
                            <span class="s2">&quot;result.networkInterfaces[0].networkIP &quot;</span>
                            <span class="s2">&quot;}}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;zone&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ result.zone | basename }}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ result.selfLink }}&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="s2">&quot;vars&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="si">%i</span><span class="s2">f success %}{{ stdout | from_json }}{</span><span class="si">% e</span><span class="s2">ndif %}&quot;</span><span class="p">}</span>
            <span class="p">}</span>
        <span class="p">),</span>
    <span class="p">)</span>

<span class="n">my_server</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="n">my_server_delete</span>
<span class="n">my_server</span><span class="o">.</span><span class="n">create</span> <span class="o">=</span> <span class="n">my_server_create</span>
</pre></div>
</div>
</div>
</div>
<p>This implementation calls <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">compute</span> <span class="pre">instances</span> <span class="pre">create</span></code> to create the instance
and then <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">compute</span> <span class="pre">instances</span> <span class="pre">describe</span></code>. The <code class="docutils literal notranslate"><span class="pre">resultTemplate</span></code> parses that json and</p>
<p>One mysterious looking line is <code class="docutils literal notranslate"><span class="pre">+*gcloudStatusMap:</span></code> which is a <a class="reference internal" href="processing.html#yaml-merge-directives"><span class="std std-ref">merge directive</span></a>
It’s referencing a yaml map we haven’t defined yet.
We’ll see it when we finish off the implementation by defining the “check” operation:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-YAML" for="sd-tab-item-6">
YAML</label><div class="sd-tab-content docutils">
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unfurl/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensemble</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">topology_template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">node_templates</span><span class="p">:</span>
<span class="w">        </span><span class="nt">my_server</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">          </span><span class="c1"># details omitted...</span>
<span class="w">          </span><span class="nt">interfaces</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># other operations omitted, see example above</span>
<span class="w">            </span><span class="nt">Install</span><span class="p">:</span>
<span class="w">              </span><span class="nt">check</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcloud compute instances describe {{ &#39;.name&#39; | eval }}  --format=json</span>
<span class="w">                </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">resultTemplate</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">+&amp;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcloudStatusMap</span>
<span class="w">                    </span><span class="nt">eval</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$result</span>
<span class="w">                      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">                        </span><span class="nt">readyState</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">{&#39;PROVISIONING&#39;:</span><span class="nv"> </span><span class="s">&#39;creating&#39;,</span><span class="nv"> </span><span class="s">&#39;STAGING&#39;:</span><span class="nv"> </span><span class="s">&#39;starting&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;RUNNING&#39;:</span><span class="nv"> </span><span class="s">&#39;started&#39;,</span><span class="nv"> </span><span class="s">&#39;REPAIRING&#39;</span><span class="nv"> </span><span class="s">&#39;error,&#39;</span>
<span class="w">                                    </span><span class="s">&#39;SUSPENDING&#39;:</span><span class="nv"> </span><span class="s">&#39;stopping&#39;,</span><span class="nv">  </span><span class="s">&#39;SUSPENDED&#39;:</span><span class="nv"> </span><span class="s">&#39;stopped&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;STOPPING&#39;:</span><span class="nv"> </span><span class="s">&#39;deleting&#39;,</span><span class="nv"> </span><span class="s">&#39;TERMINATED&#39;:</span><span class="nv"> </span><span class="s">&#39;deleted&#39;}[result.status]</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">local</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">{&#39;PROVISIONING&#39;:</span><span class="nv"> </span><span class="s">&#39;pending&#39;,</span><span class="nv"> </span><span class="s">&#39;STAGING&#39;:</span><span class="nv"> </span><span class="s">&#39;pending&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;RUNNING&#39;:</span><span class="nv"> </span><span class="s">&#39;ok&#39;,</span><span class="nv"> </span><span class="s">&#39;REPAIRING&#39;</span><span class="nv"> </span><span class="s">&#39;error,&#39;</span>
<span class="w">                                    </span><span class="s">&#39;SUSPENDING&#39;:</span><span class="nv"> </span><span class="s">&#39;error&#39;,</span><span class="nv">  </span><span class="s">&#39;SUSPENDED&#39;:</span><span class="nv"> </span><span class="s">&#39;error&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;STOPPING&#39;:</span><span class="nv"> </span><span class="s">&#39;absent&#39;,</span><span class="nv"> </span><span class="s">&#39;TERMINATED&#39;:</span><span class="nv"> </span><span class="s">&#39;absent&#39;}[result.status]</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{%if</span><span class="nv"> </span><span class="s">success</span><span class="nv"> </span><span class="s">%}{{</span><span class="nv"> </span><span class="s">stdout</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">from_json</span><span class="nv"> </span><span class="s">}}{%</span><span class="nv"> </span><span class="s">endif</span><span class="nv"> </span><span class="s">%}&quot;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-python" for="sd-tab-item-7">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;check&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_check</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="s2">&quot;gcloud compute instances describe {{ &#39;.name&#39; | eval }}  --format=json&quot;</span>
        <span class="p">),</span>
        <span class="n">resultTemplate</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;eval&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="s2">&quot;$result&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;then&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;readyState&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ {&#39;PROVISIONING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;creating&#39;, &#39;STAGING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;starting&#39;, &#39;RUNNING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;started&#39;, &#39;REPAIRING&#39; &quot;</span>
                            <span class="s2">&quot;&#39;error,&#39; &#39;SUSPENDING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;stopping&#39;,  &#39;SUSPENDED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;stopped&#39;, &#39;STOPPING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;deleting&#39;, &#39;TERMINATED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;deleted&#39;}[result.status] }}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ {&#39;PROVISIONING&#39;: &#39;pending&#39;, &quot;</span>
                            <span class="s2">&quot;&#39;STAGING&#39;: &#39;pending&#39;, &quot;</span>
                            <span class="s2">&quot;&#39;RUNNING&#39;: &#39;ok&#39;, &#39;REPAIRING&#39; &quot;</span>
                            <span class="s2">&quot;&#39;error,&#39; &#39;SUSPENDING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;error&#39;,  &#39;SUSPENDED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;error&#39;, &#39;STOPPING&#39;: &#39;absent&#39;, &quot;</span>
                            <span class="s2">&quot;&#39;TERMINATED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;absent&#39;}[result.status] }}&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="s2">&quot;vars&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="si">%i</span><span class="s2">f success %}{{ stdout | from_json }}{</span><span class="si">% e</span><span class="s2">ndif %}&quot;</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">),</span>
    <span class="p">)</span>


<span class="n">my_server</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">my_server_check</span>
</pre></div>
</div>
</div>
</div>
<p>The “check” operation is part of the <code class="docutils literal notranslate"><span class="pre">Install</span></code> interface, an Unfurl specific TOSCA extention.
It defines a “check” operation for checking the status of an existing interface; a “discover” operation for discovering pre-existing instances
and a “revert” operation for reverting changes made by Unfurl on a pre-existing resource.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">resultTemplate</span></code> (shared with <code class="docutils literal notranslate"><span class="pre">create</span></code>) maps Google Compute [“status” enumeration](<a class="reference external" href="https://cloud.google.com/compute/docs/instances/instance-life-cycle">https://cloud.google.com/compute/docs/instances/instance-life-cycle</a>) to TOSCA’s node state and to Unfurl’s operation status.
We can see that it uses TOSCA’s functions with Ansible’s Jinja2 expressions and filters, glued together using Unfurl’s expression syntax (<code class="docutils literal notranslate"><span class="pre">eval</span></code>)
<a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html</a></p>
<p>All together we have created</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-YAML" for="sd-tab-item-8">
YAML</label><div class="sd-tab-content docutils">
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unfurl/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensemble</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">service_template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">topology_template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">node_templates</span><span class="p">:</span>
<span class="w">        </span><span class="nt">my_server</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tosca.nodes.Compute</span>
<span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Host container properties</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span>
<span class="w">              </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">                </span><span class="nt">num_cpus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">                </span><span class="nt">disk_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200GB</span>
<span class="w">                </span><span class="nt">mem_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512MB</span>
<span class="w">            </span><span class="c1"># Guest Operating System properties</span>
<span class="w">            </span><span class="nt">os</span><span class="p">:</span>
<span class="w">              </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">                </span><span class="c1"># host Operating System image properties</span>
<span class="w">                </span><span class="nt">architecture</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x86_64</span>
<span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
<span class="w">                </span><span class="nt">distribution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">                </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">focal</span>
<span class="w">          </span><span class="nt">interfaces</span><span class="p">:</span>
<span class="w">            </span><span class="nt">Standard</span><span class="p">:</span>
<span class="w">              </span><span class="nt">delete</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcloud compute instances delete {{ &#39;.name&#39; | eval }}</span>
<span class="w">              </span><span class="nt">create</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">                  </span><span class="no">gcloud compute instances create {{ &#39;.name&#39; | eval }}</span>
<span class="w">                  </span><span class="no">--boot-disk-size={{ {&quot;get_property&quot;: [&quot;SELF&quot;, &quot;host&quot;, &quot;disk_size&quot;]} | eval | regex_replace(&quot; &quot;) }}</span>
<span class="w">                  </span><span class="no">--image=$(gcloud compute images list --filter=name:{{ {&#39;get_property&#39;: [&#39;SELF&#39;, &#39;os&#39;, &#39;distribution&#39;]} | eval }}</span>
<span class="w">                        </span><span class="no">--filter=name:focal --limit=1 --uri)</span>
<span class="w">                  </span><span class="no">--machine-type=e2-medium   &gt; /dev/null</span>
<span class="w">                  </span><span class="no">&amp;&amp; gcloud compute instances describe {{ &#39;.name&#39; | eval }} --format=json</span>
<span class="w">                </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">resultTemplate</span><span class="p">:</span>
<span class="w">                    </span><span class="c1"># recursively merge the map with the yaml anchor &quot;gcloudStatusMap&quot;</span>
<span class="w">                    </span><span class="c1"># +*gcloudStatusMap:</span>
<span class="w">                    </span><span class="nt">eval</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">                        </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">public_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.networkInterfaces[0].accessConfigs[0].natIP</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">private_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.networkInterfaces[0].networkIP</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">zone</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.zone</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">basename</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">id</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.selfLink</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">Install</span><span class="p">:</span>
<span class="w">              </span><span class="nt">check</span><span class="p">:</span>
<span class="w">                </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcloud compute instances describe {{ &#39;.name&#39; | eval }}  --format=json</span>
<span class="w">                </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">resultTemplate</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;gcloudStatusMap</span>
<span class="w">                    </span><span class="nt">eval</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$result</span>
<span class="w">                      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">                        </span><span class="nt">readyState</span><span class="p">:</span>
<span class="w">                          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">{&#39;PROVISIONING&#39;:</span><span class="nv"> </span><span class="s">&#39;creating&#39;,</span><span class="nv"> </span><span class="s">&#39;STAGING&#39;:</span><span class="nv"> </span><span class="s">&#39;starting&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;RUNNING&#39;:</span><span class="nv"> </span><span class="s">&#39;started&#39;,</span><span class="nv"> </span><span class="s">&#39;REPAIRING&#39;</span><span class="nv"> </span><span class="s">&#39;error,&#39;</span>
<span class="w">                                    </span><span class="s">&#39;SUSPENDING&#39;:</span><span class="nv"> </span><span class="s">&#39;stopping&#39;,</span><span class="nv">  </span><span class="s">&#39;SUSPENDED&#39;:</span><span class="nv"> </span><span class="s">&#39;stopped&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;STOPPING&#39;:</span><span class="nv"> </span><span class="s">&#39;deleting&#39;,</span><span class="nv"> </span><span class="s">&#39;TERMINATED&#39;:</span><span class="nv"> </span><span class="s">&#39;deleted&#39;}[result.status]</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                          </span><span class="nt">local</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">{&#39;PROVISIONING&#39;:</span><span class="nv"> </span><span class="s">&#39;pending&#39;,</span><span class="nv"> </span><span class="s">&#39;STAGING&#39;:</span><span class="nv"> </span><span class="s">&#39;pending&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;RUNNING&#39;:</span><span class="nv"> </span><span class="s">&#39;ok&#39;,</span><span class="nv"> </span><span class="s">&#39;REPAIRING&#39;</span><span class="nv"> </span><span class="s">&#39;error,&#39;</span>
<span class="w">                                    </span><span class="s">&#39;SUSPENDING&#39;:</span><span class="nv"> </span><span class="s">&#39;error&#39;,</span><span class="nv">  </span><span class="s">&#39;SUSPENDED&#39;:</span><span class="nv"> </span><span class="s">&#39;error&#39;,</span>
<span class="w">                                    </span><span class="s">&#39;STOPPING&#39;:</span><span class="nv"> </span><span class="s">&#39;absent&#39;,</span><span class="nv"> </span><span class="s">&#39;TERMINATED&#39;:</span><span class="nv"> </span><span class="s">&#39;absent&#39;}[result.status]</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">                    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">                      </span><span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{%if</span><span class="nv"> </span><span class="s">success</span><span class="nv"> </span><span class="s">%}{{</span><span class="nv"> </span><span class="s">stdout</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">from_json</span><span class="nv"> </span><span class="s">}}{%</span><span class="nv"> </span><span class="s">endif</span><span class="nv"> </span><span class="s">%}&quot;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" data-sync-id="tabcode-python" for="sd-tab-item-9">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">unfurl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tosca</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tosca</span><span class="w"> </span><span class="kn">import</span> <span class="n">Eval</span><span class="p">,</span> <span class="n">GB</span><span class="p">,</span> <span class="n">MB</span><span class="p">,</span> <span class="n">operation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unfurl.configurators.shell</span>


<span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;check&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_check</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="s2">&quot;gcloud compute instances describe {{ &#39;.name&#39; | eval }}  --format=json&quot;</span>
        <span class="p">),</span>
        <span class="n">resultTemplate</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;eval&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="s2">&quot;$result&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;then&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;readyState&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ {&#39;PROVISIONING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;creating&#39;, &#39;STAGING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;starting&#39;, &#39;RUNNING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;started&#39;, &#39;REPAIRING&#39; &quot;</span>
                            <span class="s2">&quot;&#39;error,&#39; &#39;SUSPENDING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;stopping&#39;,  &#39;SUSPENDED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;stopped&#39;, &#39;STOPPING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;deleting&#39;, &#39;TERMINATED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;deleted&#39;}[result.status] }}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ {&#39;PROVISIONING&#39;: &#39;pending&#39;, &quot;</span>
                            <span class="s2">&quot;&#39;STAGING&#39;: &#39;pending&#39;, &quot;</span>
                            <span class="s2">&quot;&#39;RUNNING&#39;: &#39;ok&#39;, &#39;REPAIRING&#39; &quot;</span>
                            <span class="s2">&quot;&#39;error,&#39; &#39;SUSPENDING&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;error&#39;,  &#39;SUSPENDED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;error&#39;, &#39;STOPPING&#39;: &#39;absent&#39;, &quot;</span>
                            <span class="s2">&quot;&#39;TERMINATED&#39;: &quot;</span>
                            <span class="s2">&quot;&#39;absent&#39;}[result.status] }}&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="s2">&quot;vars&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="si">%i</span><span class="s2">f success %}{{ stdout | from_json }}{</span><span class="si">% e</span><span class="s2">ndif %}&quot;</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">),</span>
    <span class="p">)</span>


<span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_delete</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span><span class="s2">&quot;gcloud compute instances delete {{ &#39;.name&#39; | eval }}&quot;</span><span class="p">),</span>
    <span class="p">)</span>


<span class="nd">@operation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;create&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_server_create</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unfurl</span><span class="o">.</span><span class="n">configurators</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellConfigurator</span><span class="p">(</span>
        <span class="n">command</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;gcloud compute instances create {{ &#39;.name&#39; | eval }}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s1">&#39;--boot-disk-size={{ {&quot;get_property&quot;: [&quot;SELF&quot;, &quot;host&quot;, &quot;disk_size&quot;]} | eval | &#39;</span>
                <span class="s1">&#39;regex_replace(&quot; &quot;) }}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s2">&quot;--image=$(gcloud compute images list --filter=name:{{ {&#39;get_property&#39;: &quot;</span>
                <span class="s2">&quot;[&#39;SELF&#39;, &#39;os&#39;, &#39;distribution&#39;]} | eval }}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;      --filter=name:focal --limit=1 --uri)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;--machine-type=e2-medium   &gt; /dev/null</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&amp;&amp; gcloud compute instances describe {{ &#39;.name&#39; | eval }} --format=json</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">resultTemplate</span><span class="o">=</span><span class="n">Eval</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;eval&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;then&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;public_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ &quot;</span>
                            <span class="s2">&quot;result.networkInterfaces[0].accessConfigs[0].natIP &quot;</span>
                            <span class="s2">&quot;}}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;private_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ &quot;</span>
                            <span class="s2">&quot;result.networkInterfaces[0].networkIP &quot;</span>
                            <span class="s2">&quot;}}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;zone&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ result.zone | basename }}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ result.selfLink }}&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">),</span>
    <span class="p">)</span>


<span class="n">my_server</span> <span class="o">=</span> <span class="n">tosca</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">Compute</span><span class="p">(</span>
    <span class="s2">&quot;my_server&quot;</span><span class="p">,</span>
    <span class="n">host</span><span class="o">=</span><span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">Compute</span><span class="p">(</span>
        <span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">disk_size</span><span class="o">=</span><span class="mi">200</span> <span class="o">*</span> <span class="n">GB</span><span class="p">,</span>
        <span class="n">mem_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">os</span><span class="o">=</span><span class="n">tosca</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">OperatingSystem</span><span class="p">(</span>
        <span class="n">architecture</span><span class="o">=</span><span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linux&quot;</span><span class="p">,</span>
        <span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">my_server</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">my_server_check</span>
<span class="n">my_server</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="n">my_server_delete</span>
<span class="n">my_server</span><span class="o">.</span><span class="n">create</span> <span class="o">=</span> <span class="n">my_server_create</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="activate-your-ensemble">
<h2>5 Activate your ensemble<a class="headerlink" href="#activate-your-ensemble" title="Permalink to this headline"></a></h2>
<ol class="arabic simple">
<li><p>Run deploy</p></li>
<li><p>Commit your changes</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, OneCommons Co..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>